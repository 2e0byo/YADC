{"version":3,"sources":["webpack:///./src/setup/App.vue?96f0","webpack:///./src/setup/App.vue?2621","webpack:///src/setup/App.vue","webpack:///./src/setup/App.vue","webpack:///./src/setup/App.vue?64c8","webpack:///./src/setup/main.js"],"names":["components","data","urlParams","URL","window","location","href","searchParams","apiURL","port","get","dataLoaded","apiUrl","session","browser","appDir","manifestDir","manifestDirEditable","isInstalling","isInstallSuccess","isInstallError","methods","getText","getExtensionId","id","protocol","setLocation","async","this","console","log","err","toString","runInstall","install","FormData","append","fetch","referrer","mode","method","body","rsp","results","json","status","Error","error","storage","created","os","_vm","_h","$createElement","_c","_self","attrs","_e","staticClass","_v","_s","model","value","callback","$$v","trim","expression","on","$event","top","document","fonts","load","Vue","el","render","h","App","init"],"mappings":"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","file":"setup/script.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js!../../node_modules/sass-loader/dist/cjs.js??ref--2-3!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js!../../node_modules/sass-loader/dist/cjs.js??ref--2-3!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","<template>\n  <div id=\"app\" v-if=\"dataLoaded\">\n    <div class=\"wrap\" v-if=\"!isInstallSuccess && !isInstallError\">\n      <div class=\"title\">\n        {{ getText('pageContent_installTitle') }}\n      </div>\n      <div class=\"desc\">\n        {{ getText('pageContent_installDesc') }}\n      </div>\n\n      <v-textfield\n        v-model.trim=\"appDir\"\n        :label=\"getText('inputLabel_appLocation')\"\n      >\n      </v-textfield>\n\n      <div class=\"manifest-desc\" v-if=\"manifestDirEditable\">\n        {{ getText('pageContent_manifestLocationDesc') }}\n      </div>\n\n      <v-textfield\n        v-if=\"manifestDirEditable\"\n        v-model.trim=\"manifestDir\"\n        :label=\"getText('inputLabel_manifestLocation')\"\n      >\n      </v-textfield>\n\n      <v-button\n        class=\"button install-button\"\n        :unelevated=\"true\"\n        :disabled=\"\n          isInstalling || !appDir || (manifestDirEditable && !manifestDir)\n        \"\n        :label=\"getText('buttonText_installApp')\"\n        @click=\"runInstall\"\n      >\n      </v-button>\n    </div>\n\n    <div class=\"wrap\" v-if=\"isInstallSuccess\">\n      <div class=\"title\">{{ getText('pageContent_installSuccessTitle') }}</div>\n      <div class=\"desc\">{{ getText('pageContent_installSuccessDesc') }}</div>\n\n      <div class=\"success-icon\">ðŸŽ‰</div>\n    </div>\n\n    <div class=\"wrap\" v-if=\"isInstallError\">\n      <div class=\"title error-title\">\n        {{ getText('pageContent_installErrorTitle') }}\n      </div>\n      <div class=\"desc\">{{ getText('pageContent_installErrorDesc') }}</div>\n\n      <v-button\n        class=\"button error-button\"\n        :unelevated=\"true\"\n        :label=\"getText('buttonText_goBack')\"\n        @click=\"isInstallError = false\"\n      >\n      </v-button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport browser from 'webextension-polyfill';\nimport {Button, TextField} from 'ext-components';\n\nimport storage from 'storage/storage';\nimport {pingClientApp} from 'utils/app';\nimport {getText} from 'utils/common';\nimport {targetEnv} from 'utils/config';\n\nexport default {\n  components: {\n    [Button.name]: Button,\n    [TextField.name]: TextField\n  },\n\n  data: function () {\n    const urlParams = new URL(window.location.href).searchParams;\n    const apiURL = new URL('http://127.0.0.1/api/v1');\n    apiURL.port = urlParams.get('port');\n\n    return {\n      dataLoaded: false,\n\n      apiUrl: apiURL.href,\n      session: urlParams.get('session'),\n      browser: '',\n      appDir: '',\n      manifestDir: '',\n      manifestDirEditable: false,\n\n      isInstalling: false,\n      isInstallSuccess: false,\n      isInstallError: false\n    };\n  },\n\n  methods: {\n    getText,\n\n    getExtensionId: function () {\n      let id = browser.runtime.id;\n      if (targetEnv !== 'firefox') {\n        const scheme = window.location.protocol;\n        id = `${scheme}//${id}/`;\n      }\n\n      return id;\n    },\n\n    setLocation: async function () {\n      try {\n        await this.location();\n      } catch (err) {\n        this.isInstallError = true;\n        console.log(err.toString());\n      }\n    },\n\n    runInstall: async function () {\n      this.isInstalling = true;\n\n      try {\n        await this.install();\n      } catch (err) {\n        this.isInstallError = true;\n        console.log(err.toString());\n      } finally {\n        this.isInstalling = false;\n      }\n\n      if (this.isInstallSuccess) {\n        const data = new FormData();\n        data.append('session', this.session);\n\n        await fetch(`${this.apiUrl}/setup/close`, {\n          referrer: '',\n          mode: 'cors',\n          method: 'POST',\n          body: data\n        });\n      }\n    },\n\n    location: async function () {\n      const data = new FormData();\n      data.append('session', this.session);\n      data.append('browser', this.browser);\n      data.append('targetEnv', targetEnv);\n\n      const rsp = await fetch(`${this.apiUrl}/setup/location`, {\n        referrer: '',\n        mode: 'cors',\n        method: 'POST',\n        body: data\n      });\n\n      const results = await rsp.json();\n\n      if (rsp.status === 200) {\n        this.appDir = results.appDir;\n        this.manifestDir = results.manifestDir;\n      } else {\n        throw new Error(results.error);\n      }\n    },\n\n    install: async function () {\n      const data = new FormData();\n      data.append('session', this.session);\n      data.append('appDir', this.appDir);\n      data.append('manifestDir', this.manifestDir);\n      data.append('browser', this.browser);\n      data.append('targetEnv', targetEnv);\n      data.append('extension', this.getExtensionId());\n\n      const rsp = await fetch(`${this.apiUrl}/setup/install`, {\n        referrer: '',\n        mode: 'cors',\n        method: 'POST',\n        body: data\n      });\n\n      if (rsp.status === 200) {\n        await pingClientApp();\n        await storage.set({simulateUserInput: true}, 'sync');\n\n        this.isInstallSuccess = true;\n      } else {\n        throw new Error((await rsp.json()).error);\n      }\n    }\n  },\n\n  created: async function () {\n    this.browser = (await browser.runtime.sendMessage({id: 'getBrowser'})).name;\n\n    await this.setLocation();\n\n    const {os} = await browser.runtime.sendMessage({id: 'getPlatform'});\n    if (os !== 'windows') {\n      this.manifestDirEditable = true;\n    }\n\n    this.dataLoaded = true;\n  }\n};\n</script>\n\n<style lang=\"scss\">\n$mdc-theme-primary: #1abc9c;\n\n@import '@material/theme/mixins';\n@import '@material/typography/mixins';\n@import '@material/button/mixins';\n\nbody {\n  @include mdc-typography-base;\n  font-size: 100%;\n  background-color: #ecf0f1;\n  margin: 0;\n}\n\n#app {\n  display: flex;\n  justify-content: center;\n  padding: 12px;\n}\n\n.wrap {\n  display: flex;\n  flex-direction: column;\n  max-width: 400px;\n}\n\n.title,\n.desc,\n.manifest-desc {\n  @include mdc-theme-prop(color, text-primary-on-light);\n}\n\n.title {\n  @include mdc-typography(headline6);\n  margin-top: 48px;\n}\n\n.error-title {\n  color: #e74c3c;\n}\n\n.desc {\n  @include mdc-typography(body2);\n  margin-top: 24px;\n  margin-bottom: 24px;\n}\n\n.manifest-desc {\n  @include mdc-typography(caption);\n  margin-top: 12px;\n  margin-bottom: 4px;\n}\n\n.button {\n  @include mdc-button-ink-color(#fff);\n  width: 200px;\n  height: 48px;\n}\n\n.install-button {\n  margin-top: 36px;\n}\n\n.error-button {\n  margin-top: 12px;\n}\n\n.success-icon {\n  font-size: 72px;\n  margin-top: 36px;\n}\n</style>\n","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=183ee2fc&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.dataLoaded)?_c('div',{attrs:{\"id\":\"app\"}},[(!_vm.isInstallSuccess && !_vm.isInstallError)?_c('div',{staticClass:\"wrap\"},[_c('div',{staticClass:\"title\"},[_vm._v(\"\\n      \"+_vm._s(_vm.getText('pageContent_installTitle'))+\"\\n    \")]),_vm._v(\" \"),_c('div',{staticClass:\"desc\"},[_vm._v(\"\\n      \"+_vm._s(_vm.getText('pageContent_installDesc'))+\"\\n    \")]),_vm._v(\" \"),_c('v-textfield',{attrs:{\"label\":_vm.getText('inputLabel_appLocation')},model:{value:(_vm.appDir),callback:function ($$v) {_vm.appDir=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"appDir\"}}),_vm._v(\" \"),(_vm.manifestDirEditable)?_c('div',{staticClass:\"manifest-desc\"},[_vm._v(\"\\n      \"+_vm._s(_vm.getText('pageContent_manifestLocationDesc'))+\"\\n    \")]):_vm._e(),_vm._v(\" \"),(_vm.manifestDirEditable)?_c('v-textfield',{attrs:{\"label\":_vm.getText('inputLabel_manifestLocation')},model:{value:(_vm.manifestDir),callback:function ($$v) {_vm.manifestDir=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"manifestDir\"}}):_vm._e(),_vm._v(\" \"),_c('v-button',{staticClass:\"button install-button\",attrs:{\"unelevated\":true,\"disabled\":_vm.isInstalling || !_vm.appDir || (_vm.manifestDirEditable && !_vm.manifestDir),\"label\":_vm.getText('buttonText_installApp')},on:{\"click\":_vm.runInstall}})],1):_vm._e(),_vm._v(\" \"),(_vm.isInstallSuccess)?_c('div',{staticClass:\"wrap\"},[_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.getText('pageContent_installSuccessTitle')))]),_vm._v(\" \"),_c('div',{staticClass:\"desc\"},[_vm._v(_vm._s(_vm.getText('pageContent_installSuccessDesc')))]),_vm._v(\" \"),_c('div',{staticClass:\"success-icon\"},[_vm._v(\"ðŸŽ‰\")])]):_vm._e(),_vm._v(\" \"),(_vm.isInstallError)?_c('div',{staticClass:\"wrap\"},[_c('div',{staticClass:\"title error-title\"},[_vm._v(\"\\n      \"+_vm._s(_vm.getText('pageContent_installErrorTitle'))+\"\\n    \")]),_vm._v(\" \"),_c('div',{staticClass:\"desc\"},[_vm._v(_vm._s(_vm.getText('pageContent_installErrorDesc')))]),_vm._v(\" \"),_c('v-button',{staticClass:\"button error-button\",attrs:{\"unelevated\":true,\"label\":_vm.getText('buttonText_goBack')},on:{\"click\":function($event){_vm.isInstallError = false}}})],1):_vm._e()]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue';\n\nimport App from './App';\n\nasync function init() {\n  try {\n    await document.fonts.load('400 14px Roboto');\n    await document.fonts.load('500 14px Roboto');\n  } catch (err) {}\n\n  new Vue({\n    el: '#app',\n    render: h => h(App)\n  });\n}\n\n// only run in a frame\nif (window.top !== window) {\n  init();\n}\n"],"sourceRoot":""}